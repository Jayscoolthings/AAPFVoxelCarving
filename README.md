# SorghumVoxelCarvingAAPF

The most important part of getting the program functioning properly lies in making sure that the dependencies are properly set up. I have noticed many times that without properly configured dependencies, the program will fail without error, which is extremely frustrating. 

First, make sure that you have Visual Studio installed, along with the Qt Visual Studio Tools extension. The Qt version isn't super important, but try to stick with a version that is named in the format of 5.xx.x_msvc2019_64. In the original readme, Mathieu recommends Qt version 5.12.0, but this version isn't available through the Qt Maintenance Tool anymore, so I've been using 5.15.0, which has not given any issues. 

For the OpenCV version, the program is configured to use 4.2.0, which I have stuck with. It is available through this link: https://sourceforge.net/projects/opencvlibrary/files/4.2.0/opencv-4.2.0-vc14_vc15.exe/download. After downloading the OpenCV.exe, open it and it will ask you where to extract the files. I decided to extract mine to C:/opencv, but it is ultimately unimportant where these are extracted, as long as you keep note of where the files are. Now, to make sure that the OpenCV files are properly linked to the project in Visual Studio, open the SorghumReconstruction.sln file and on the right side of the screen in the file explorer, right click the tab that says "SorghumReconstruction" and at the bottom click properties. We need to check for a few things here. First, on the left side of the property page, click on the tab that says "C/C++". Then, hover the cursor over the "Additional Include Directories" field and click the small dropdown arrow that will appear on the right of the field. Now click edit. In the first box, scroll down and double click on a blank line to create a new entry. You need to enter "$(OPENCVDIR)\build\include\opencv2" You may already see "$(OPENCVDIR)\build\include" in the list of paths, but if not, add that too. Now, press "Ok" and exit that tab to go back to the property page. Now, on the left side, click the tab titled "Linker". Here, edit the "Additional Dependencies " field, and make sure that it includes "opencv_world420.lib". Finally, on the left side of the screen, click on the tab that says "VC++ Directories" and then edit the field titled "Library Directories". Here, make sure that you include "C:\opencv\build\x64\vc15\lib". Press "Ok", then "Apply", then at the top of the screen under "Build", click "Rebuild Solution". This should get rid of any OpenCV reference errors in the code. At this point, you should also be able to click "Build" to build the program completely. Just make sure that on the top of the screen, you have "Release" and "x64" selected as the build platform.

Now the final dependency is DGTal, but this one is the most difficult to install and where I ran into the most issues. DGTal has 3 co-dependencies, being CMake, zlib, and Boost. CMake can be installed from this link: https://cmake.org/download/. It is a straightforward install that is described on the website. Now for zlib and Boost, I decided to use vcpkg to install these libraries, as it is the most straightforward method I've found. To install vcpkg, you'll first need to clone the vcpkg repository using the following command: git clone https://github.com/microsoft/vcpkg.git After running this command, go ahead and go into the vcpkg folder that's been created and run .\bootstrap-vcpkg.bat This command will download the vcpkg executable and make the program ready for use, but if we want to access vcpkg from the command line, we'll have to add the vcpkg folder to the Windows PATH variable. To do this, press the windows key and search for "edit environment variables", then in the window that is opened, go to environment variables.Here, we can edit PATH and add the vcpkg folder to it. Now, to make our installed vcpkg packages available in our project, we just need to run "vcpkg integrate install" on our vcpkg directory. Now to install zlib and boost, we just need to run "vcpkg install zlib boost". Running this command may take a while, as boost is quite a large library. After installation has finished, you can run "vcpkg list" in your command prompt to bring up a list of all the installed packages. There will probably be a lot of listings for boost, as it has many different modules, and you should also see zlib in there too. Now, to make sure these packages are also properly integrated in Visual Studio, I've included an additional project inside the solution called "TestVcpkg" This can be compiled like the "SorghumReconstruction" project was, and the .exe will be put into the x64/Release folder. If the dependencies have been installed properly, this program should give you their version numbers. Now, to install DGtal, you can use the command "git clone https://github.com/DGtal-team/DGtal" to download the source code, then run the following commands in the directory that you downloaded the source code: "mkdir build; cd build", "cmake -S .. -B . -DBUILD_SHARED_LIBS=FALSE". These commands will build the project and create a .sln file within the build folder. You can open this .sln file in Visual Studio and compile DGtal from here.

Now that all dependencies are installed, the rest of the program can be setup. Navigate to SorghumVoxelCarving-master/scripts and run setup.sh. This will copy the program files from the x64 directory and create new directories for images and data. After this completes, you'll have to go to the location where you have Qt installed, usually at C:\Qt\5.15\msvc2019_64\bin and copy the address of windeployqt.exe. You'll then need to run this exe on the program directory that was created when you ran the setup.sh script. From this point on, you can use the .sh files as detailed in the readme inside the scripts folder, however, I'd recommend that you familiarize yourself with how the .exe is called from these .sh files as well, as if there is an error while running the program and you are only running the .sh file, the error messages either won't appear at all, or they will be much less verbose. The way that you can call the .exe directly is by the following syntax: "./SorghumReconstruction.exe -c [calibration/calibration_top/reconstruction/density/directionality/surface/height/process_skeleton/train_classifier] -i [input directory] -o [output directory]. 

For calibration, it is important that you are using the proper calibration images. Calibration images are stored in scripts/program/images/calibration. Inside Calibration.cpp, the potLocation variable and potTopLocation variables will need to be updated in order to accommodate the new pot images. I have already done this with the centered pot images and I've created a segmentation mask image as well. If the calibration images are to be adjusted or changed, though, these variables will need updated inside of calibration.cpp.
